<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript">if (location.protocol !== 'https:' && location.hostname == 'ceramic-engine.com') location.replace('https:'+location.href.substring(location.protocol.length));</script>
        <meta charset="utf-8">
        <link rel="icon" href="/static/favicon.png"/>
        <link rel="apple-touch-icon" href="/static/touch-icon.png"/>
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <title>State Machines - Ceramic</title>
        <link rel="stylesheet" href="/static/style.css" type="text/css" />
        <link rel="stylesheet" href="/static/prism.css" type="text/css" />
        <script type="text/javascript" src="/static/script.js"></script>
        <meta property="og:site_name" content="Ceramic Engine" />
        <meta property="og:title" content="State Machines - Ceramic" />
        <meta property="og:description" content="A cross-platform &amp; open-source 2D framework" />
        <meta property="og:image" content="/static/img/ceramic-800-450.png" />
        <meta property="og:image:type" content="image/png" />
        <meta property="og:image:width" content="800" />
        <meta property="og:image:height" content="450" />
        
    </head>
    <body id="page-guides" class="page page-standard">
        <aside id="site-navigation">
            <ul>
                <li><a href="/"><img src="/static/ceramic-small.png" class="ceramic-icon" />Ceramic</a></li>
                <li class="selected"><a href="/guides">Guides</a></li>
                <li><a href="/examples">Examples</a></li>
                <li><a href="/blog">Blog</a></li>
                <li><a href="/api-docs">API Docs</a></li>
                <li><a href="https://github.com/ceramic-engine/ceramic">GitHub</a></li>
                <li><a href="/discord">Discord</a></li>
            </ul>
        </aside>
        
<div class="page-container">
    <div class="sidebar-left">
        
        <aside class="sidebar">
            <ul>
            
                
                <li class="menu-title">Introduction</li>
                <li class="">
                    <ul>
                        
                            <li>
                                <a href="/guides/discover-ceramic/">Discover Ceramic</a>
                            </li>
                        
                    </ul>
                </li>
            
                
                <li class="menu-title">Getting Started</li>
                <li class="">
                    <ul>
                        
                            <li>
                                <a href="/guides/install-ceramic/">Install Ceramic</a>
                            </li>
                        
                            <li>
                                <a href="/guides/your-first-project/">Your first Ceramic project</a>
                            </li>
                        
                            <li>
                                <a href="/guides/editing-your-project/">Editing your project</a>
                            </li>
                        
                            <li>
                                <a href="/guides/display-a-square/">Display a square</a>
                            </li>
                        
                            <li>
                                <a href="/guides/display-an-image/">Display an image</a>
                            </li>
                        
                            <li>
                                <a href="/guides/moving-visuals/">Moving visuals</a>
                            </li>
                        
                    </ul>
                </li>
            
                
                <li class="menu-title selected">Handbook</li>
                <li class="expanded">
                    <ul>
                        
                            <li>
                                <a href="/guides/entities/">Entities</a>
                            </li>
                        
                            <li>
                                <a href="/guides/events/">Events</a>
                            </li>
                        
                            <li>
                                <a href="/guides/visuals/">Visuals</a>
                            </li>
                        
                            <li>
                                <a href="/guides/components/">Components</a>
                            </li>
                        
                            <li>
                                <a href="/guides/text/">Text</a>
                            </li>
                        
                            <li>
                                <a href="/guides/audio/">Audio</a>
                            </li>
                        
                            <li>
                                <a href="/guides/assets/">Assets</a>
                            </li>
                        
                            <li>
                                <a href="/guides/scenes/">Scenes</a>
                            </li>
                        
                            <li>
                                <a href="/guides/filters/">Filters</a>
                            </li>
                        
                            <li class="selected">
                                <a href="/guides/state-machines/">State Machines</a>
                            </li>
                        
                            <li>
                                <a href="/guides/observables/">Observables</a>
                            </li>
                        
                            <li>
                                <a href="/guides/systems/">Systems</a>
                            </li>
                        
                    </ul>
                </li>
            
                
                <li class="menu-title">Appendices</li>
                <li class="">
                    <ul>
                        
                            <li>
                                <a href="/guides/inside-a-default-project/">Inside a default project</a>
                            </li>
                        
                            <li>
                                <a href="/guides/ceramic-via-git/">Ceramic via Git</a>
                            </li>
                        
                            <li>
                                <a href="/guides/platform-setup/">Platform Setup</a>
                            </li>
                        
                            <li>
                                <a href="/guides/ceramic-yml-reference/">Reference: ceramic.yml</a>
                            </li>
                        
                            <li>
                                <a href="/guides/defines/">Ceramic Defines</a>
                            </li>
                        
                    </ul>
                </li>
            
                
                <li class="menu-title">Extras</li>
                <li class="">
                    <ul>
                        
                            <li>
                                <a href="/guides/faq/">FAQ</a>
                            </li>
                        
                    </ul>
                </li>
            
            </ul>
        </aside>
        
    </div>
    <div class="content-right">
        <main>
            <h1>State Machines</h1>
<p>State machines are very helpful to let you structure the state of different objects in your app. <strong>Ceramic</strong> provides a flexible <code>StateMachine&lt;T&gt;</code> type that can adapt to different situations.</p>
<h2 id="the-gist-of-it" tabindex="-1">The gist of it <a class="header-anchor" href="#the-gist-of-it"><span aria-hidden="true" class="header-anchor__symbol">#</span></a></h2>
<div class="codename">A basic example usage of <code>StateMachine&lt;T&gt;</code></div>
<pre class="language-haxe"><code class="language-haxe"><span class="highlight-line"><span class="token comment">// Describe the possible states with an enum</span></span>
<span class="highlight-line"><span class="token keyword">enum</span> SomeEnum</span>
<span class="highlight-line"><span class="token punctuation">{</span></span>
<span class="highlight-line">    WALKING<span class="token punctuation">;</span></span>
<span class="highlight-line">    IDLE<span class="token punctuation">;</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">class</span> SomeVisual <span class="token keyword">extends</span> Visual</span>
<span class="highlight-line"><span class="token punctuation">{</span></span>
<span class="highlight-line">    <span class="token comment">// Add a state machine as component using the enum above</span></span>
<span class="highlight-line">    <span class="token metadata symbol">@component</span> <span class="token keyword">var</span> machine <span class="token operator">=</span> <span class="token keyword">new</span> StateMachine<span class="token operator">&lt;</span>SomeEnum<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="highlight-line">    <span class="token punctuation">{</span></span>
<span class="highlight-line">        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">        <span class="token comment">// Set initial state</span></span>
<span class="highlight-line">        machine<span class="token punctuation">.</span>state <span class="token operator">=</span> WALKING<span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token punctuation">}</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token keyword">function</span> <span class="token function">WALKING_enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="highlight-line">    <span class="token keyword">function</span> <span class="token function">WALKING_update</span><span class="token punctuation">(</span>delta<span class="token punctuation">:</span>Float<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="highlight-line">    <span class="token keyword">function</span> <span class="token function">WALKING_exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token keyword">function</span> <span class="token function">IDLE_enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="highlight-line">    <span class="token keyword">function</span> <span class="token function">IDLE_update</span><span class="token punctuation">(</span>delta<span class="token punctuation">:</span>Float<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="highlight-line">    <span class="token keyword">function</span> <span class="token function">IDLE_exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>This is the most straightforward way of using state machines in a class:</p>
<ol>
<li>Create an <code>enum</code> (or an <code>enum abstract</code>) describing your different states</li>
<li>Add a <code>StateMachine&lt;YourEnum&gt;</code> as <a href="/guides/components/">component</a> in your class</li>
<li>Implement the methods that will be automatically called depending on the state</li>
<li>Assign your state to <code>machine.state</code></li>
</ol>
<p class="extra-info">This will work on any object that is an <a href="/guides/entities/">Entity</a> subclass, including visuals etc...</p>
<p class="extra-info">Ceramic took inspiration from an existing library in C#: <a href="https://github.com/prime31/StateKit">StateKit</a>. Although the ideas are very similar, Ceramic is pushing it a bit further by taking advantage of compile time macros in Haxe to provide additional features like plugging a state machine as component to an existing entity class. It also uses macros to optimize state machines as much as possible: there is no dynamic access involved, everything is statically resolved.</p>
<h3 id="the-methods" tabindex="-1">The methods <a class="header-anchor" href="#the-methods"><span aria-hidden="true" class="header-anchor__symbol">#</span></a></h3>
<p>In the above example, when the <code>state</code> is set to <code>WALKING</code>, then if provided, the <code>WALKING_enter()</code> method will be called once. Following this call, the <code>WALKING_update()</code> method will be called at every frame with a <code>delta</code> time value, so you can implement state-specific update logic.</p>
<p>Later, when you change the state again, for instance with <code>machine.state = IDLE</code>, the <code>WALKING_exit()</code> method will be called, then <code>IDLE_enter()</code> and again <code>IDLE_update()</code> at every frame.</p>
<p class="extra-info">You don't have to implements all the methods if you don't need some, they are all optional.</p>
<h2 id="more-separation" tabindex="-1">More separation <a class="header-anchor" href="#more-separation"><span aria-hidden="true" class="header-anchor__symbol">#</span></a></h2>
<p>If you prefer to have all your <strong>state machine</strong> code in a different class than where you set the <code>state</code>, you can create subclasses of <code>StateMachine&lt;T&gt;</code>. Here is the same example as before, but using a separate class for the state machine:</p>
<div class="codename">Creating a state machine in a separate class</div>
<pre class="language-haxe"><code class="language-haxe"><span class="highlight-line"><span class="token keyword">enum</span> SomeEnum</span>
<span class="highlight-line"><span class="token punctuation">{</span></span>
<span class="highlight-line">    WALKING<span class="token punctuation">;</span></span>
<span class="highlight-line">    IDLE<span class="token punctuation">;</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">class</span> SomeStateMachine <span class="token keyword">extends</span> StateMachine<span class="token operator">&lt;</span>SomeEnum<span class="token operator">></span> <span class="token punctuation">{</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token comment">// This time, the methods are directly</span></span>
<span class="highlight-line">    <span class="token comment">// located inside the state machine subclass,</span></span>
<span class="highlight-line">    <span class="token comment">// instead of where it will be instanciated.</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token keyword">function</span> <span class="token function">WALKING_enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="highlight-line">    <span class="token keyword">function</span> <span class="token function">WALKING_update</span><span class="token punctuation">(</span>delta<span class="token punctuation">:</span>Float<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="highlight-line">    <span class="token keyword">function</span> <span class="token function">WALKING_exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token keyword">function</span> <span class="token function">IDLE_enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="highlight-line">    <span class="token keyword">function</span> <span class="token function">IDLE_update</span><span class="token punctuation">(</span>delta<span class="token punctuation">:</span>Float<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="highlight-line">    <span class="token keyword">function</span> <span class="token function">IDLE_exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<div class="codename">Using that state machine in another class</div>
<pre class="language-haxe"><code class="language-haxe"><span class="highlight-line"><span class="token keyword">class</span> SomeVisual <span class="token keyword">extends</span> Visual</span>
<span class="highlight-line"><span class="token punctuation">{</span></span>
<span class="highlight-line">    <span class="token metadata symbol">@component</span> <span class="token keyword">var</span> machine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">SomeStateMachine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="highlight-line">    <span class="token punctuation">{</span></span>
<span class="highlight-line">        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">        <span class="token comment">// Set initial state</span></span>
<span class="highlight-line">        machine<span class="token punctuation">.</span>state <span class="token operator">=</span> WALKING<span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token punctuation">}</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token operator">...</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<h2 id="one-object-for-each-state" tabindex="-1">One object for each state <a class="header-anchor" href="#one-object-for-each-state"><span aria-hidden="true" class="header-anchor__symbol">#</span></a></h2>
<p>If you start to have a lot of code in each of your state handling code (in <code>_enter()</code>/<code>_update()</code>/<code>_exit()</code> methods), you can separate things even more by creating dedicated objects for each state:</p>
<div class="codename">Creating a state machine with state objects</div>
<pre class="language-haxe"><code class="language-haxe"><span class="highlight-line"><span class="token comment">// Create a new state machine</span></span>
<span class="highlight-line"><span class="token keyword">var</span> machine <span class="token operator">=</span> <span class="token keyword">new</span> StateMachine<span class="token operator">&lt;</span>SomeEnum<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token comment">// Assign dedicated state objects</span></span>
<span class="highlight-line">machine<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>WALKING<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token function">WalkingState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">machine<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>IDLE<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token function">IdleState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token comment">// Set current state</span></span>
<span class="highlight-line">machine<span class="token punctuation">.</span>state <span class="token operator">=</span> WALKING<span class="token punctuation">;</span></span></code></pre>
<p>So what's inside those state objects? Here is an example for the <code>WalkingState</code> class:</p>
<div class="codename">WalkingState.hx</div>
<pre class="language-haxe"><code class="language-haxe"><span class="highlight-line"><span class="token keyword">import</span> ceramic<span class="token punctuation">.</span>State<span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">class</span> WalkingState <span class="token keyword">extends</span> State <span class="token punctuation">{</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token keyword">override</span> <span class="token keyword">function</span> <span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>Void <span class="token punctuation">{</span></span>
<span class="highlight-line">        <span class="token comment">// Called when entering this state</span></span>
<span class="highlight-line">    <span class="token punctuation">}</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token keyword">override</span> <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span>delta<span class="token punctuation">:</span>Float<span class="token punctuation">)</span><span class="token punctuation">:</span>Void <span class="token punctuation">{</span></span>
<span class="highlight-line">        <span class="token comment">// Called at every frame when</span></span>
<span class="highlight-line">        <span class="token comment">// the machine has this state</span></span>
<span class="highlight-line">    <span class="token punctuation">}</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token keyword">override</span> <span class="token keyword">function</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>Void <span class="token punctuation">{</span></span>
<span class="highlight-line">        <span class="token comment">// Called when exiting this state</span></span>
<span class="highlight-line">    <span class="token punctuation">}</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>That's it! You would have a similar class for <code>IdleState</code>. This way, you can separate each state code in different classes and organize your code better if needed.</p>
<p class="extra-info">In my opinion, among the different options explained above, there is not one way really better than the other. It mostly depends on your use case and your preferences. I find the <em>- component / everything in the same class -</em> way convenient when I just want to add a state machine to an existing object, and don't want to have to look at too many places to understand what the code is doing, but you might also prefer to separate things more in some other situations. It could also be relevant to use separate state objects if you want to reuse the same <code>State</code> classes with different <code>StateMachine</code> objects.</p>
<h3 id="thats-all-about-state-machines-for-now" tabindex="-1">That's all about state machines for now <a class="header-anchor" href="#thats-all-about-state-machines-for-now"><span aria-hidden="true" class="header-anchor__symbol">#</span></a></h3>
<p>This guide should have gave you a good overview of how you can use state machines in Ceramic. You can see a practical usage of <code>StateMachine</code> from the <a href="/examples/pixel-platformer/">pixel platformer</a> sample, and more specifically the <a href="https://github.com/ceramic-engine/ceramic-samples/blob/master/pixel-platformer/src/Player.hx"><code>Player</code> class source code</a>.</p>

            
                
                        <hr />
                        <p>
                            Continue reading &#10132; <a href="/guides/observables/">Observables</a>
                        </p>
                        
            
            
            <hr />
            <div id="like-counter"></div>
            <script src="https://utteranc.es/client.js"
                repo="ceramic-engine/ceramic-comments"
                issue-term="pathname"
                theme="github-dark"
                crossorigin="anonymous"
                async>
            </script>
            
        </main>
    </div>
</div>
    </body>
</html>