<!DOCTYPE html>
<html>
    <head>
        <script type="text/javascript">if (location.protocol !== 'https:' && location.hostname == 'ceramic-engine.com') location.replace('https:'+location.href.substring(location.protocol.length));</script>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="icon" href="/static/favicon.png"/>
        <link rel="apple-touch-icon" href="/static/touch-icon.png"/>
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <title>Observables - Ceramic</title>
        <link rel="stylesheet" href="/static/lucide-font/lucide.css" type="text/css" />
        <link rel="stylesheet" href="/static/style.css" type="text/css" />
        <link rel="stylesheet" href="/static/prism.css" type="text/css" />
        <script type="text/javascript" src="/static/script.js"></script>
        <meta property="og:site_name" content="Ceramic Engine" />
        <meta property="og:title" content="Observables - Ceramic" />
        <meta property="og:description" content="A cross-platform &amp; open-source 2D framework" />
        <meta property="og:image" content="/static/img/ceramic-800-450.png" />
        <meta property="og:image:type" content="image/png" />
        <meta property="og:image:width" content="800" />
        <meta property="og:image:height" content="450" />
        
    </head>
    <body id="page-guides" class="page page-standard">
        <aside id="site-navigation">
            <div class="nav-header">
                <a href="/" class="nav-logo"><img src="/static/ceramic-small.png" class="ceramic-icon" />Ceramic</a>
                <button class="hamburger" aria-label="Toggle menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <ul class="nav-links">
                <li><a href="/"><img src="/static/ceramic-small.png" class="ceramic-icon" />Ceramic</a></li>
                <li class="selected"><a href="/guides">Guides</a></li>
                <li><a href="/examples">Examples</a></li>
                <li><a href="/blog">Blog</a></li>
                <li><a href="/api-docs/clay-native">API Docs</a></li>
                <li><a href="https://github.com/ceramic-engine/ceramic">GitHub</a></li>
                <li><a href="/discord">Discord</a></li>
            </ul>
        </aside>
        
<div class="page-container">
    <div class="sidebar-left">
        
        <aside class="sidebar">
            <ul>
            
                
                <li class="menu-title">Introduction</li>
                <li class="">
                    <ul>
                        
                            <li>
                                <a href="/guides/discover-ceramic/">Discover Ceramic</a>
                            </li>
                        
                    </ul>
                </li>
            
                
                <li class="menu-title">Getting Started</li>
                <li class="">
                    <ul>
                        
                            <li>
                                <a href="/guides/install-ceramic/">Install Ceramic</a>
                            </li>
                        
                            <li>
                                <a href="/guides/your-first-project/">Your first Ceramic project</a>
                            </li>
                        
                            <li>
                                <a href="/guides/editing-your-project/">Editing your project</a>
                            </li>
                        
                            <li>
                                <a href="/guides/display-a-square/">Display a square</a>
                            </li>
                        
                            <li>
                                <a href="/guides/display-an-image/">Display an image</a>
                            </li>
                        
                            <li>
                                <a href="/guides/moving-visuals/">Moving visuals</a>
                            </li>
                        
                    </ul>
                </li>
            
                
                <li class="menu-title selected">Handbook</li>
                <li class="expanded">
                    <ul>
                        
                            <li>
                                <a href="/guides/entities/">Entities</a>
                            </li>
                        
                            <li>
                                <a href="/guides/events/">Events</a>
                            </li>
                        
                            <li>
                                <a href="/guides/visuals/">Visuals</a>
                            </li>
                        
                            <li>
                                <a href="/guides/components/">Components</a>
                            </li>
                        
                            <li>
                                <a href="/guides/text/">Text</a>
                            </li>
                        
                            <li>
                                <a href="/guides/audio/">Audio</a>
                            </li>
                        
                            <li>
                                <a href="/guides/assets/">Assets</a>
                            </li>
                        
                            <li>
                                <a href="/guides/scenes/">Scenes</a>
                            </li>
                        
                            <li>
                                <a href="/guides/filters/">Filters</a>
                            </li>
                        
                            <li>
                                <a href="/guides/state-machines/">State Machines</a>
                            </li>
                        
                            <li class="selected">
                                <a href="/guides/observables/">Observables</a>
                            </li>
                        
                            <li>
                                <a href="/guides/systems/">Systems</a>
                            </li>
                        
                            <li>
                                <a href="/guides/sprites/">Sprites</a>
                            </li>
                        
                            <li>
                                <a href="/guides/input/">Input</a>
                            </li>
                        
                    </ul>
                </li>
            
                
                <li class="menu-title">Appendices</li>
                <li class="">
                    <ul>
                        
                            <li>
                                <a href="/guides/inside-a-default-project/">Inside a default project</a>
                            </li>
                        
                            <li>
                                <a href="/guides/ceramic-via-git/">Ceramic via Git</a>
                            </li>
                        
                            <li>
                                <a href="/guides/platform-setup/">Platform Setup</a>
                            </li>
                        
                            <li>
                                <a href="/guides/ceramic-yml-reference/">Reference: ceramic.yml</a>
                            </li>
                        
                            <li>
                                <a href="/guides/defines/">Ceramic Defines</a>
                            </li>
                        
                    </ul>
                </li>
            
                
                <li class="menu-title">Extras</li>
                <li class="">
                    <ul>
                        
                            <li>
                                <a href="/guides/faq/">FAQ</a>
                            </li>
                        
                    </ul>
                </li>
            
            </ul>
        </aside>
        
    </div>
    <div class="content-right">
        <main>
            <h1>Observables</h1>
<p>Ceramic has a powerful <strong>observable</strong> API thanks to the <a href="https://github.com/jeremyfa/tracker">tracker</a> library.</p>
<p>It allows you to know when a field has changed so you can update your display (or anything else) as a reaction to that change.</p>
<h2 id="how-to-make-a-field-observable" tabindex="-1">How to make a field observable <a class="header-anchor" href="#how-to-make-a-field-observable"><span aria-hidden="true" class="header-anchor__symbol">#</span></a></h2>
<div class="codename">An example with observable <code>name</code> field</div>
<pre class="language-haxe"><code class="language-haxe"><span class="highlight-line"><span class="token keyword">import</span> ceramic<span class="token punctuation">.</span>Entity<span class="token punctuation">;</span></span>
<span class="highlight-line"><span class="token keyword">import</span> tracker<span class="token punctuation">.</span>Observable<span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="token comment">/**
<span class="highlight-line"> * A `Person` is an `Entity` that is made observable</span>
<span class="highlight-line"> * by implementing the `Observable` interface</span>
 */</span>
<span class="highlight-line"><span class="token keyword">class</span> Person <span class="token keyword">extends</span> Entity <span class="token keyword">implements</span> Observable <span class="token punctuation">{</span></span>
<span class="highlight-line"></span>
    <span class="token comment">/**
<span class="highlight-line">     * An observable field</span>
     */</span>
<span class="highlight-line">    <span class="token metadata symbol">@observe</span> <span class="token keyword">public</span> <span class="token keyword">var</span> name<span class="token punctuation">:</span>String <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">        <span class="token comment">// Track name change</span></span>
<span class="highlight-line">        <span class="token function">onNameChange</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> nameChanged<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token punctuation">}</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token keyword">function</span> <span class="token function">nameChanged</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span>String<span class="token punctuation">,</span> previousName<span class="token punctuation">:</span>String<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">        <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">'Name: <span class="token interpolation"><span class="token interpolation variable">$name</span></span> (previous: <span class="token interpolation"><span class="token interpolation variable">$previousName</span></span>)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token punctuation">}</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>This is a simple example where:</p>
<ol>
<li>
<p>We create a <code>Person</code> class that inherits from <code>Entity</code>, and more importantly implements the <code>Observable</code> interface.</p>
</li>
<li>
<p>Thanks to the <code>Observable</code> interface we implement, we can now use the <code>@observe</code> meta on any instance field. That's what we do on the <code>name</code> field to make it <strong>observable</strong>.</p>
</li>
<li>
<p>Now that the <code>name</code> field is <strong>observable</strong>, it provides a new <code>nameChange</code> event on the class, so we can use <code>onNameChange()</code> to be notified when the <code>name</code> field is modified. We do that in the constructor: our <code>nameChanged()</code> method will be called every time the <code>name</code> field changes.</p>
</li>
</ol>
<p class="extra-info">Want to learn more about <strong>events</strong>? Check the <a href="/guides/events/">events guide</a> out!</p>
<ol start="4">
<li>In the <code>nameChanged()</code> method of our class, we print the name so that we will add a line to the console output everytime the name changes.</li>
</ol>
<p>Let's test this code!</p>
<div class="codename">Testing the <code>Person</code> code</div>
<pre class="language-haxe"><code class="language-haxe"><span class="highlight-line"><span class="token comment">// Create a person object</span></span>
<span class="highlight-line"><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"><span class="token comment">// Set its name to John</span></span>
<span class="highlight-line">person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'John'</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token operator">...</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token comment">// Later, update the name and set it to Ellen</span></span>
<span class="highlight-line">person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Ellen'</span><span class="token punctuation">;</span></span></code></pre>
<p>This is what you should see in your console:</p>
<div class="codename">Console output</div>
<pre class="language-text"><code class="language-text"><span class="highlight-line">Name: John (previous: null)</span>
<span class="highlight-line">Name: Ellen (previous: John)</span></code></pre>
<p>That's it! You know how to create <strong>observable</strong> fields and get notified when they change.</p>
<h2 id="computed-fields" tabindex="-1">Computed fields <a class="header-anchor" href="#computed-fields"><span aria-hidden="true" class="header-anchor__symbol">#</span></a></h2>
<p>What if you want to have a field that is computed from another <strong>observable</strong> field? For instance, we'd like to add a <code>valid</code> field to our <code>Person</code> object that tells us if the current object is valid or not. That is: does it have a valid <code>name</code> field?</p>
<p>Let's assume a <code>Person</code> object is valid if:</p>
<ul>
<li>The <code>name</code> field is not null</li>
<li>The <code>name</code> field has at least 2 characters</li>
<li>The <code>name</code> field has maximum 20 characters</li>
</ul>
<p class="extra-info">This is of course just an example to illustrate the feature. A proper name validation would likely be a bit more advanced than that, using a regular expression, checking there is no line break etc...</p>
<p>We could create a custom getter that does all these checks to return <code>true</code> or <code>false</code> everytime we query it, but there is a better solution: <strong>computed</strong> fields.</p>
<p>A <strong>computed</strong> field is also an <strong>observable</strong> field, but is computed from other observable fields. Let's see how it looks like in practice:</p>
<div class="codename">Updated example with computed <code>valid</code> field</div>
<pre class="language-haxe"><code class="language-haxe"><span class="highlight-line"><span class="token keyword">import</span> ceramic<span class="token punctuation">.</span>Entity<span class="token punctuation">;</span></span>
<span class="highlight-line"><span class="token keyword">import</span> tracker<span class="token punctuation">.</span>Observable<span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="token comment">/**
<span class="highlight-line"> * A `Person` is an `Entity` that is made observable</span>
<span class="highlight-line"> * by implementing the `Observable` interface</span>
 */</span>
<span class="highlight-line"><span class="token keyword">class</span> Person <span class="token keyword">extends</span> Entity <span class="token keyword">implements</span> Observable <span class="token punctuation">{</span></span>
<span class="highlight-line"></span>
    <span class="token comment">/**
<span class="highlight-line">     * An observable field</span>
     */</span>
<span class="highlight-line">    <span class="token metadata symbol">@observe</span> <span class="token keyword">public</span> <span class="token keyword">var</span> name<span class="token punctuation">:</span>String <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
    <span class="token comment">/**
<span class="highlight-line">     * A computed field</span>
     */</span>
<span class="highlight-line">    <span class="token metadata symbol">@compute</span> <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">valid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>Bool <span class="token punctuation">{</span></span>
<span class="highlight-line">        <span class="token comment">// Get our observable `name` value</span></span>
<span class="highlight-line">        <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">        <span class="token comment">// Do a few checks</span></span>
<span class="highlight-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span></span>
<span class="highlight-line">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="highlight-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span></span>
<span class="highlight-line">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="highlight-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">20</span><span class="token punctuation">)</span></span>
<span class="highlight-line">            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">        <span class="token comment">// Everything ok, return true</span></span>
<span class="highlight-line">        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token punctuation">}</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token keyword">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">        <span class="token comment">// Track name change</span></span>
<span class="highlight-line">        <span class="token function">onNameChange</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> nameChanged<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token punctuation">}</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token keyword">function</span> <span class="token function">nameChanged</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span>String<span class="token punctuation">,</span> previousName<span class="token punctuation">:</span>String<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">        <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">'Name: <span class="token interpolation"><span class="token interpolation variable">$name</span></span> (previous: <span class="token interpolation"><span class="token interpolation variable">$previousName</span></span>)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token punctuation">}</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>What did we do?</p>
<ol>
<li>
<p>We added a <strong>computed</strong> field, which is written as a function with the <code>@compute</code> meta. In our code, we will read the field as a variable, as the function is only used as the <em>compute function</em> internally.</p>
</li>
<li>
<p>Inside that <em>compute function</em>, we generate a boolean <code>true</code> or <code>false</code> depending on whether the name fits our criterias or not.</p>
</li>
<li>
<p>That means when we will read <code>person.valid</code>, the result will be <code>true</code> or <code>false</code> depending on the <code>Person</code>, and <code>Person.name</code> data.</p>
</li>
</ol>
<p>Let's test this:</p>
<div class="codename">Testing again with a computed field</div>
<pre class="language-haxe"><code class="language-haxe"><span class="highlight-line"><span class="token comment">// Create a person object</span></span>
<span class="highlight-line"><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token comment">// Check if it becomes valid/invalid later</span></span>
<span class="highlight-line">person<span class="token punctuation">.</span><span class="token function">onValidChange</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>valid<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">{</span></span>
<span class="highlight-line">    <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">'Valid: <span class="token interpolation"><span class="token interpolation variable">$valid</span></span>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token comment">// Set the name to John</span></span>
<span class="highlight-line">person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'John'</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token operator">...</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token comment">// Later, update the name and set it to ?</span></span>
<span class="highlight-line">person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'?'</span><span class="token punctuation">;</span></span></code></pre>
<p>This is what you should see in your console this time:</p>
<div class="codename">Console output</div>
<pre class="language-text"><code class="language-text"><span class="highlight-line">Name: John (previous: null)</span>
<span class="highlight-line">Valid: true</span>
<span class="highlight-line">Name: ? (previous: John)</span>
<span class="highlight-line">Valid: false</span></code></pre>
<p>As you can see, the <code>valid</code> field acts like an <strong>observable</strong> field too: we can listen to the <code>validChange</code> event and get notified when it changes, even when just the <code>name</code> it depends on has changed. Pretty cool isn't it?</p>
<p class="extra-info">Computed fields can be useful to optimize your code when the values you need to resolve are expensive to evaluate. Indeed, <strong>Ceramic</strong> will run the computation methods only when needed, that is, when the observable values it depends on have changed. It is also good to note that if you never use some computed field in your code, it will not even be computed!</p>
<p class="extra-info">In the above examples, we implemented the <code>Observable</code> interface so that the <code>@observe</code> and <code>@compute</code> metas are properly handled. If you want to add <strong>observable</strong> or <strong>computed</strong> fields in a <code>Scene</code> subclass, know that you don't need to implement the <code>Observable</code> interface because it is already implemented by the parent <code>Scene</code> class already!</p>
<h2 id="autorun" tabindex="-1">Autorun <a class="header-anchor" href="#autorun"><span aria-hidden="true" class="header-anchor__symbol">#</span></a></h2>
<p>Sometimes, you may want to run some code everytime a groupe of multiple <strong>observable</strong> and/or <strong>computed</strong> fields have changed. In that situation, you could listen to the <code>{field}Change</code> event of each of the fields you depend on, but that could become tedious to maintain and require a lot of boilerplate code in the long run.</p>
<p>Instead, you can cover that use case with much less code using: <code>autorun()</code></p>
<div class="codename">Setting up</div>
<pre class="language-haxe"><code class="language-haxe"><span class="highlight-line"><span class="token keyword">import</span> ceramic<span class="token punctuation">.</span>Scene<span class="token punctuation">;</span></span>
<span class="highlight-line"><span class="token keyword">import</span> ceramic<span class="token punctuation">.</span>Timer<span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token keyword">class</span> MainScene <span class="token keyword">extends</span> Scene <span class="token punctuation">{</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token keyword">var</span> person1<span class="token punctuation">:</span>Person<span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token keyword">var</span> person2<span class="token punctuation">:</span>Person<span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token keyword">override</span> <span class="token keyword">function</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">        person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">        person2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">        <span class="token comment">// Bind `printNames()` with an `autorun()`</span></span>
<span class="highlight-line">        <span class="token function">autorun</span><span class="token punctuation">(</span>printNames<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">        <span class="token comment">// Change names gradually</span></span>
<span class="highlight-line">        Timer<span class="token punctuation">.</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> person1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'John'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">        Timer<span class="token punctuation">.</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> person2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Ellen'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">        Timer<span class="token punctuation">.</span><span class="token function">delay</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> person1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token punctuation">}</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token keyword">function</span> <span class="token function">printNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">        <span class="token comment">// Our autorun-bound method will be evaluated once,</span></span>
<span class="highlight-line">        <span class="token comment">// and everytime one of the observable/computed fields</span></span>
<span class="highlight-line">        <span class="token comment">// it has read is modified. In that case, it will</span></span>
<span class="highlight-line">        <span class="token comment">// run again if person1.valid, person1.name,</span></span>
<span class="highlight-line">        <span class="token comment">// person2.valid or person2.name have changed.</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">        <span class="token keyword">if</span> <span class="token punctuation">(</span>person1<span class="token punctuation">.</span>valid <span class="token operator">&amp;&amp;</span> person2<span class="token punctuation">.</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">            <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">'Hello, <span class="token interpolation"><span class="token interpolation variable">$</span><span class="token punctuation">{</span>person1<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span> and <span class="token interpolation"><span class="token interpolation variable">$</span><span class="token punctuation">{</span>person2<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">        <span class="token punctuation">}</span></span>
<span class="highlight-line">        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>person1<span class="token punctuation">.</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">            <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">'Hello, <span class="token interpolation"><span class="token interpolation variable">$</span><span class="token punctuation">{</span>person1<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>, and you!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">        <span class="token punctuation">}</span></span>
<span class="highlight-line">        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>person2<span class="token punctuation">.</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">            <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">'Hello, you, and <span class="token interpolation"><span class="token interpolation variable">$</span><span class="token punctuation">{</span>person2<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span>!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">        <span class="token punctuation">}</span></span>
<span class="highlight-line">        <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">            <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">'Hello you two!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">        <span class="token punctuation">}</span></span>
<span class="highlight-line">    <span class="token punctuation">}</span></span>
<span class="highlight-line"><span class="token punctuation">}</span></span></code></pre>
<p>What did we do this time?</p>
<ol>
<li>
<p>We created two <code>Person</code> objects</p>
</li>
<li>
<p>We bound the <code>printNames()</code> method with an <code>autorun()</code></p>
</li>
<li>
<p>Then, we gradually changed the name of each person through time</p>
</li>
<li>
<p>In reaction, the bound <code>printNames()</code> method should be re-evaluated automatically when the names are changing.</p>
</li>
</ol>
<p>This is what you should see in the console output:</p>
<div class="codename">Console output</div>
<pre class="language-text"><code class="language-text"><span class="highlight-line">Hello you two!</span>
<span class="highlight-line">Name: John (previous: null)</span>
<span class="highlight-line">Hello, John, and you!</span>
<span class="highlight-line">Name: Ellen (previous: null)</span>
<span class="highlight-line">Hello, John and Ellen!</span>
<span class="highlight-line">Name: ? (previous: John)</span>
<span class="highlight-line">Hello, you, and Ellen!</span></code></pre>
<h3 id="what-is-happening-there" tabindex="-1">What is happening there? <a class="header-anchor" href="#what-is-happening-there"><span aria-hidden="true" class="header-anchor__symbol">#</span></a></h3>
<p>In the <code>printNames()</code> method bound by an <code>autorun()</code>, <strong>Ceramic</strong> creates <em>implicit bindings</em>. Remember when we used <code>onNameChange()</code> or <code>onValidChange()</code>? Well, this is basically what an <code>autorun()</code> does for you without having to write this code yourself. For instance, if, in the bound <code>printNames()</code> method we read <code>person1.valid</code>, it will automatically listen to the <code>validChange</code> event of the <code>person1</code> variable, and <strong>invalidate</strong> the autorun if later <code>person1.valid</code> does change.</p>
<p>When an <code>autorun()</code> function is <strong>invalidated</strong>, it <strong>runs</strong> again, then all <strong>observable</strong> and <strong>computed</strong> fields are read again and new <em>implicit bindings</em> are created.</p>
<p>So, in other words: an <code>autorun-bound</code> function runs once when it is created, then runs again every time anything it observes changes.</p>
<p class="extra-info">The <code>autorun()</code> method is available from any <code>Entity</code> subclass, including <code>Scene</code> and <code>Visual</code> objects. It can be a powerful building block to create <strong>reactive UI</strong> or trigger actions automatically when some conditions are met. Think of this as a new versatile item in your tool belt!</p>
<p class="extra-info">This <strong>autorun</strong> API is quite similar to <a href="https://mobx.js.org/reactions.html#autorun">MobX Autorun</a>.</p>
<h3 id="unobserve-reobserve" tabindex="-1"><code>unobserve()</code> / <code>reobserve()</code> <a class="header-anchor" href="#unobserve-reobserve"><span aria-hidden="true" class="header-anchor__symbol">#</span></a></h3>
<p>Sometimes, you may want to run side effects from an <code>autorun()</code> function that will read <strong>observable</strong> or <strong>computed</strong> values that you don't want to depend on. The <code>unobserve()</code> and <code>reobserve()</code> methods help you achieve that:</p>
<div class="codename">Disabling auto-observation in <code>autorun()</code></div>
<pre class="language-haxe"><code class="language-haxe"><span class="highlight-line"><span class="token function">autorun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">{</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token comment">// Read the `valid` computed value.</span></span>
<span class="highlight-line">    <span class="token comment">// This will let the autorun</span></span>
<span class="highlight-line">    <span class="token comment">// observe the `valid` field</span></span>
<span class="highlight-line">    <span class="token keyword">var</span> valid <span class="token operator">=</span> person<span class="token punctuation">.</span>valid<span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token comment">// Stop observing fields</span></span>
<span class="highlight-line">    <span class="token function">unobserve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token comment">// Reading `person.name` here won't have</span></span>
<span class="highlight-line">    <span class="token comment">// any effect to the autorun's bindings, even</span></span>
<span class="highlight-line">    <span class="token comment">// though the `name` field is observable,</span></span>
<span class="highlight-line">    <span class="token comment">// because the read is surrounded by unobserve/reobserve</span></span>
<span class="highlight-line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">        <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">'Yay!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">        <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">'Name "'</span> <span class="token operator">+</span> person<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'" is valid!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token punctuation">}</span></span>
<span class="highlight-line">    <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="highlight-line">        <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">'Unfortunately...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">        <span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">'Name "'</span> <span class="token operator">+</span> person<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'" is invalid.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line">    <span class="token punctuation">}</span></span>
<span class="highlight-line"></span>
<span class="highlight-line">    <span class="token comment">// Resume observing fields</span></span>
<span class="highlight-line">    <span class="token function">reobserve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="highlight-line"></span>
<span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<p class="extra-info">The final <code>reobserve()</code> call is actually <strong>optional</strong> here because we didn't need to evaluate any code after and are just reaching the end of the autorun function. In that situation, it can be omitted as <strong>Ceramic</strong> will take care of auto-closing any <code>unobserve</code>/<code>reobserve</code> block at the end of an autorun function evaluation. If, however, you wanted to actually read another <strong>observable</strong> or <strong>computed</strong> field after logging <code>person.name</code> in the above code, you could do so by keeping the <code>reobserve()</code> call and write code just after.</p>
<p class="extra-info">Using <code>unobserve()</code> and <code>reobserve()</code> calls at the right places can be useful in some complex situations where you read a lot of values and want to execute side effects without creating an uncontrollable chain of reaction. This could be necessary if your side effects are modifying the values you are also observing. Surrounding some code with <code>unobserve()</code> and <code>reobserve()</code> will ensure it doesn't trigger unexpected behaviour from your <code>autorun()</code>  function.</p>
<h3 id="thats-all-about-observables" tabindex="-1">That's all about observables <a class="header-anchor" href="#thats-all-about-observables"><span aria-hidden="true" class="header-anchor__symbol">#</span></a></h3>
<p>All in all, using <strong>observable</strong> and <strong>computed</strong> fields, in addition to <code>autorun()</code> functions, can be very powerful to create advanced features with very little code.</p>
<p>Feel free to take a look at the <a href="https://github.com/ceramic-engine/ceramic/tree/master/plugins/elements/runtime/src/elements">elements plugin source code</a> if you want to see a real use case taking advantage of these features!</p>

            
                
                        <hr />
                        <p>
                            Continue reading &#10132; <a href="/guides/systems/">Systems</a>
                        </p>
                        
            
            
            <hr />
            <div id="like-counter"></div>
            <script src="https://utteranc.es/client.js"
                repo="ceramic-engine/ceramic-comments"
                issue-term="pathname"
                theme="github-dark"
                crossorigin="anonymous"
                async>
            </script>
            
        </main>
    </div>
</div>
    </body>
</html>